# Introduction
This is a developing and introductory Geant4 simulation package for possible future mu2e+ experiment design. The setup is very primitive, but can be used as a starting point for more complex designs and simulations. The package can implement either a primary muon beam or photon beam outside or within a target (which is made of calcium 40) depending different macro files to be used along with the executable program (which users have to build on their own from the source code provided in this repository). After the primary beam is generated, users can extract photon and positron information from the outputed root files after all runs and events have been recorded. The current root files record several aspects of the secondary particles:

- Hit position on the sensitive detector
- Total energy deposited in MeV
- Energy spectrum of photons (can be primary or secondary)
- Energy spectrum of positrons (only secondary)
- Counter of total number of positron generation events from high energy gamma pair prodction
- Counter of the number of positron generation events *in target* from high energy gamma pair prodction

More personalized user-needed information and data can be added in RunAction.cpp, EventAction.cpp, or SteppingAction.cpp depending on the nature of data in inquiry, *e.g.*, the total energy deposition, total hits within a **run** should be added in RunAction.cpp; similarly data in need which happened during an event should search for EventAction.cpp and so forth.

The current project aims to identify two important background signals in a common mu2e+ experiment: Radioactive Muon Capture (RMC) and Decay in Orbit (DIO). For a mu2e+ experiment, signal e+ is extremely rare to be detected, thus, background positron signals need to be suppressed. RMC happens when a muon is _captured_ by an atomic nucleus, subsequently decaying by emitting a high energy gamma which can pair-produce positrons and electrons; DIO happens when muon is _stopped_ in the target, forming a muonic atom, and can subsequently decay through $\mu^-\rightarrow e^-+\overline{\nu_e}$. When charge is misidentified, DIO can fake signal as well. The users are encouraged to investigate different setups to minimize these two background processes by observing primarily:

- Energy spectrum of positrons generated by RMC only
- Energy spectrum of electrons generated by DIO only
- Energy spectrum of positrons by mu2e+ signal (by generating positrons within the target with energy given by theoretical predictions)

and comparing these pieces of spectrum information by considering branching ratios, detector response, and so forth. Users should consult their own references and needs in considering what processes to investigate (_e.g._, if charge identification is very accurate, DIO may be ignored).

# Quick start
First-time users to Geant4 and this project can follow the steps below for quick start of compiling and building the code:
1. Download Geant4 from the [website](https://geant4.web.cern.ch/download/11.2.2.html); for easier installation, binary releases should be good enough to begin with.
2. Make sure the installation is complete, go to the project folder (the folder containing main.cpp and CMakelists.txt downloaded from this repository).
3. Create a new directory "__build__" (or other names preferred, like "bin").
4. Open a terminal, and cd to the build directory just created.
5. Type on command line `cmake ..`, this setup the build enviroment and configurations for a proper build later.
6. Type on command line `make` for Linux users or `cmake --build . --config Release` for Windows users. This build the project and an executable program should have been created.
7. In Linux, type on command line `/mu2p` to run the program; In Windows, cd to "__Release__" folder and type `mu2p.exe` to run the program. In both cases, users can pass a second argument to specify macro files to be used, _e.g._, `/mu2p run.mac` in Linux and `mu2p.exe run.mac` in windows.
8. This completes the program building and initializing.
9. In the Graphical User Interface (GUI) just popped up from the program running, at the bottom, find the command line; this command line is used to execute macrofiles or control different settings during each run of the simulation. To open or change a particular macro file being used, type `/control/execute filename.mac` (Note to windows users: all the macro files in the "__mac__" folder should also be copied to the "__Release__" folder before attempting to run macro files; the CMakeLists.txt file has done this for all users during compilation, but in case anything regarding the macro files needs to be changed immediately, change it in the "__Release__" folder).
10. To start a run, either click on the "rightarrow" icon on top of the GUI or type `/control/execute run.mac`. Default run.mac will turn on the beam for 20 times, and users are free to change the setups in run.mac.
11. This completes a run, and users should have the root files ready for post-processing.

# Macro files summary
Below summarizes the functionality of different macro files, and users can choose the one appropriate to begin with:

- __gammaSpectrum.mac__: Contains probability histograms used to model RMC photon spectrum (given by a so-called closure approximation), can be used by gengamma.mac
- __gengamma.mac__: photon generator, default starts inside the target and travels along the beam direction; energy spectrum is modeled by gammaSpectrum.mac
- __gen.mac__: muon generator, default starts from one end of the world volume, and travel towards the target (the beam direction); energy is modeled by a Gaussian beam with a center energy 100 MeV-100 GeV depending on the needs.
- __run.mac__: turn on the beam for several times (default 20 times); users are free to modify and add more complex features here for ease of experiment running (_e.g._, change beam energy during each run)
- __vis.mac__: visualization module with a photon filter (photons will not appear in the visualization window); default particle lines drawn by particle ID, with muon yellow color, electron red color, and positron blue color, etc.
- __visgamma.mac__: visualization module without a photon filter; default drawn by particle ID

# Quick file introduction and functionality summary
To personalize user's own experiment preference, modifications can be made in `src` folder and corresponding `include` header folder without any changes to `main.cpp`. Brief functionalities are introduced below for essential files needed:

- SteppingAction.cpp: set any data to collect during a step, this can be the particle's instant momentum, creator processes (if applicable), particle ID identification, etc.
- EventAction.cpp: set any data to collect after an event is completed, this can be the total energy deposited by the primary particles after all interactions have been completed.
- RunAction.cpp: Set any data to collect after a run is completed. This can be a cumulation of total energy deposited by several times of beams being turned on (which trigger multiple events)
- DetectorConstruction.cpp: Create your detector specifics, including world volume to be the largest volume the particle can go to, target volume for a fixed-target experiment design, and sensitive detectors to simulate hits information.
- ActionInitialization.cpp: normally do not need to be changed unless a new type of user action apart from stepping/event/run action is used (_e.g._, tracking action, etc.)
- SensitiveDetector.cpp: create a detailed specification of the functionality the sensitive detector needs to have; only after this specification is completed, can in detector construction a sensitive detector be implemented.
- PhysicsList.cpp: implement user-defined physics list; current list only includes standard EM modular processes and optical physics, which is sufficient to simulate scattering and photon conversions to e+e- pair. For more complex capture studies or more advanced processes, user has to define in this file with more detailed information.
- ParticleSourceAction.cpp/ParticleGunAction.cpp: set the primary beam generator; usually do not need to be changed, only changing gen.mac or gengamma.mac is sufficient to create different types of primary particles.

# Other files
In the main project folder, GammaEneHistGenerator.py is a Python script to generate RMC spectrum histograms and the file gammaSpectrum.mac used by other macro files.
